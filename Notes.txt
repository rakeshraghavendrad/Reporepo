if schema:
    try:
        # Try loading JSON from the response (after cleaning)
        json_result = json.loads(response_text.strip("```json").strip("`").strip())
        return schema(**json_result)
    except json.JSONDecodeError:
        print("⚠️ Model output is not valid JSON. Returning raw response instead.")
        print("🔎 Raw model output:\n", response_text)
        # fallback: skip schema parsing and just return raw output
        return response_text
else:
    return response_text
