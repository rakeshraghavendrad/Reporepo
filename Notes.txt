import re
import json

# Remove code fences and language identifiers
cleaned_response = re.sub(r"^```(?:json)?\n|```$", "", response_text.strip(), flags=re.DOTALL)

try:
    json_result = json.loads(cleaned_response)
    return schema(**json_result)
except json.JSONDecodeError:
    print("⚠️ Model output is not valid JSON. Returning raw response instead.")
    print(response_text)
    return response_text
