import re
import pandas as pd

# Define your input path
path = "C:\\Users\\kk052484\\lc..."  # <- update with your full path
input_file = path + "behave_tests.log"

# Keyword â†’ List of (field name, regex pattern scoped to field)
kw = {
    "Prompt on compelling photographic or email evidence returned": [
        ("evidence", r'evidence="([^"]+)"'),
        ("input_", r'input_="([^"]+)"'),
        ("is_compelling", r'is_compelling="([^"]+)"')
    ]
}

data = []

# Read log file
with open(input_file, "r", encoding="utf-8") as infile:
    lines = infile.readlines()

# Loop through keywords and extract each field
for keyword, field_patterns in kw.items():
    match_found = False
    row = {"check": keyword}

    for line in lines:
        if keyword in line:
            print(f"\nâœ” Matched line:\n{line.strip()}\n")  # Optional debug print
            for field, pattern in field_patterns:
                match = re.search(pattern, line)
                if match:
                    value = match.group(1).strip()
                    row[field] = value
                    print(f"{field} âž¤ {value}")  # Optional debug print
                else:
                    row[field] = "Not found"
                    print(f"{field} âž¤ Not found")  # Optional debug print
            match_found = True
            break

    if not match_found:
        for field, _ in field_patterns:
            row[field] = "Not available in the log, hence no evidence"

    data.append(row)

# Create DataFrame
df = pd.DataFrame(data)

# Display or save result
print("\nðŸ“Š Extracted DataFrame:")
print(df)

# Optional: Save to CSV
# df.to_csv("extracted_log_data.csv", index=False)
